name: Generate and Deploy JavaDoc

on:
  push:
    branches: [ master ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  javadoc:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    
    - name: Set up JDK 8
      uses: actions/setup-java@v3
      with:
        java-version: '8'
        distribution: 'temurin'
        
    - name: Generate JavaDoc
      run: mvn javadoc:javadoc -Dmaven.javadoc.failOnError=false
      continue-on-error: true
      
    - name: Copy JavaDoc to docs
      run: |
        rm -rf docs
        mkdir -p docs
        if [ -d "target/site/apidocs" ]; then
          cp -r target/site/apidocs/* docs/
        else
          echo "JavaDoc generation failed, creating placeholder"
          echo "<h1>JavaDoc will be available soon</h1>" > docs/index.html
        fi
        
    - name: Commit JavaDoc
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add docs
        git diff --quiet && git diff --staged --quiet || git commit -m "Actualizar JavaDoc autom√°ticamente"
        
    - name: Push changes
      run: |
        git push
